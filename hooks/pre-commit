#!/bin/bash

source ~/.dotfiles/functions/bash_support.sh
source ~/.dotfiles/functions/git_support.sh

git_system && exit 0

exit_code=0

if [[ -f .eslintrc ]] || [[ -f .eslintrc.js ]]; then
  git_fake_auto_stash
  js_files=$(git_modified .js .jsx)
  if [[ ! -z $js_files ]]; then
    echodo node_modules/.bin/eslint --fix $js_files
    echodo node_modules/.bin/prettier-eslint --write $js_files
    git diff $js_files
    [[ -z "$(git diff $js_files)" ]] || exit 1
  fi
fi

if [[ -f .rubocop.yml ]]; then
  git_fake_auto_stash
  rb_files=$(git_modified .rb .jbuilder .builder Gemfile)
  if [[ ! -z $rb_files ]]; then
    echodo bundle exec rubocop -a --force-exclusion --color --fail-level=C --display-only-fail-level-offenses $rb_files || exit 1
    git diff $rb_files
    [[ -z "$(git diff $rb_files)" ]] || exit 1
  fi
fi

if [[ -f .spellr.yml ]]; then
  git_fake_auto_stash
  if [[ ! -z "$(git_modified)" ]]; then
    CI_DOCKER=1 echodo spellr -i $(git_modified) || exit 1
  fi
fi

